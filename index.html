const express = require("express");
const { Telegraf } = require("telegraf");

const bot = new Telegraf("8550152760:AAHQVkglO6KwUE5NlxGEvmAoAocf1rFJm38");
const app = express();

app.use(express.json());

// Webhook endpoint
app.post("/webhook", (req, res) => {
  bot.handleUpdate(req.body);
  res.sendStatus(200);
});

// –ö–æ–º–∞–Ω–¥–∞ /start
bot.start((ctx) => {
  ctx.reply("–ù–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –∏–≥—Ä–∞—Ç—å üëá", {
    reply_markup: {
      keyboard: [
        [
          {
            text: "üéÆ –ò–≥—Ä–∞—Ç—å",
            web_app: { url: "https://uid00178.github.io/hippogame/" }
          }
        ]
      ],
      resize_keyboard: true
    }
  });
});

// –ö–æ–º–∞–Ω–¥–∞ /play
bot.command("play", (ctx) => {
  ctx.reply("–ó–∞–ø—É—Å–∫–∞—é –∏–≥—Ä—É üëá", {
    reply_markup: {
      inline_keyboard: [
        [
          {
            text: "–ò–≥—Ä–∞—Ç—å üéÆ",
            web_app: { url: "https://uid00178.github.io/hippogame/" }
          }
        ]
      ]
    }
  });
});

const PORT = process.env.PORT || 3000;

app.listen(PORT, async () => {
  console.log(`Server running on port ${PORT}`);
  
  // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º webhook –ü–û–°–õ–ï –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞
  try {
    await bot.telegram.setWebhook(`https://hippogame-production.up.railway.app/webhook`);
    console.log("Webhook set successfully!");
  } catch (error) {
    console.error("Error setting webhook:", error);
  }
});
